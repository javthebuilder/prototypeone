!function(){var t=angular.module("AppServices",["ngSanitize"]);t.directive("stringToNumber",function(){return{require:"ngModel",link:function(t,e,o,r){r.$parsers.push(function(t){return""+t}),r.$formatters.push(function(t){return parseFloat(t)})}}}),t.factory("SQLSTATEFactory",[function(){var t={state:function(t){var e=(t=t.message).indexOf("SQLSTATE[23000]"),o=t.indexOf("1451"),r=t.indexOf("SQLSTATE[23000]"),a=t.indexOf("1062"),n=(t.indexOf(),t.indexOf("exception_title")),i=t.indexOf("MethodNotAllowedHttpException");-1!==e&&-1!==o?(PNotify.removeAll(),new PNotify({title:"Error(s) found!",text:"Cannot delete selected row. <br> record is reference by another transaction",type:"error"})):-1!==r&&-1!==a?(PNotify.removeAll(),new PNotify({title:"Error(s) found!",text:"Integrity constraint violation [1062]. <br> record already exists",type:"error"})):-1!==n&&-1!==i?(PNotify.removeAll(),new PNotify({title:"Error(s) found!",text:"Access denied. <br>you do not have permession to perform this transaction",type:"error"})):(PNotify.removeAll(),new PNotify({title:"Error(s) found!",text:"please see logs for details",type:"error"}),console.log(t))}};return t}]),t.factory("GlobalFactory",[function(){var t={icons:function(t,e){switch(t){case"save":return"<i class='fa fa-floppy-o' aria-hidden='true'></i>&nbsp;Save";case"loading":return"<i class='fa fa-spinner fa-pulse fa-fw'></i> <span class='sr-only'>Loading...</span>";default:return""}},configLoadingBlade:function(t){switch(t){case"on":$("#main-cardcontent").prop("hidden",!0),$("#loading").prop("hidden",!1);break;case"off":$("#main-cardcontent").prop("hidden",!1),$("#loading").prop("hidden",!0)}},configAjaxSubmitBlade:function(e){switch(e){case"on":$("#ajaxBackUrl").prop("hidden",!0),$("#btnAjaxSubmit").prop("disabled",!0),$("#msgAjaxSubmit").html(t.icons("loading")+"");break;case"off":$("#ajaxBackUrl").prop("hidden",!1),$("#btnAjaxSubmit").prop("disabled",!1),$("#msgAjaxSubmit").html(t.icons("save"))}},configLoadingPOSTransactions:function(t,e){switch(t){case"on":$("#loadingtransactions").prop("hidden",!1),$("#divtransactions").prop("hidden",!0),e.issubmitting=!0;break;case"off":$("#loadingtransactions").prop("hidden",!0),$("#divtransactions").prop("hidden",!1),e.issubmitting=!1}},configAjaxSubmitModal:function(e){switch(e){case"on":$("#ajaxmodalfooterclose").prop("disabled",!0),$("#ajaxmodalfootersubmit").prop("disabled",!0),$("#msgAjaxModalSubmit").html(t.icons("loading"));break;case"off":$("#ajaxmodalfooterclose").prop("disabled",!1),$("#ajaxmodalfootersubmit").prop("disabled",!1),$("#msgAjaxModalSubmit").html(t.icons("save"))}}};return t}]),t.factory("PNotifyFactory",[function(){var t={PNotifyConfirm:function(t,e,o,r){PNotify.removeAll(),new PNotify({title:"Confirmation Needed",text:"Are you sure you want to "+t.form_title+" selected record? <br><br> <b> Note: ACTION IS IRREVERSIBLE </b>",icon:"icon-question-sign icon-large",width:"400px",height:"250px",type:"error",hide:!1,confirm:{confirm:!0},buttons:{closer:!0,sticker:!1},history:{history:!1},addclass:"stack-modal",stack:{dir1:"down",dir2:"right",modal:!0}}).get().on("pnotify.confirm",r).on("pnotify.cancel",function(){})},setConfirmation:function(t,e,o,r){if(void 0!==t.selectedID||""!=t.selectedID||null!=t.selectedID)switch(t.form_title=t.form_title.toLowerCase(),t.form_title){case"delete":var a=function(){var a=r+"/delete/"+t.selectedID;e.put(a,{}).then(function(t){location.reload()},function(t){o.state(t.data)})};-1!==(n=void 0!==t.selectedStat?t.selectedStat.toUpperCase():"").indexOf("ACTIVE")||-1!==n.indexOf("IN-ACTIVE")||""==n?this.PNotifyConfirm(t,e,o,a):(PNotify.removeAll(),new PNotify({title:"Opps! status = "+n,text:"you can only delete records if the status is FOR POSTING",type:"info"}));break;case"update_sales_stat":var n,i="ACTIVE"==(n=void 0!==t.selectedStat?t.selectedStat.toUpperCase():"")?0:1;a=function(){var a=r+"/update/"+t.selectedID;e.post(a,{stat:i}).then(function(t){location.reload()},function(t){o.state(t.data)})};new PNotify({title:"Confirmation Needed",text:"Are you sure you want to <b>"+(1==i?"open":"close")+"</b> selected record? <br>",icon:"icon-question-sign icon-large",width:"400px",height:"250px",type:"error",hide:!1,confirm:{confirm:!0},buttons:{closer:!0,sticker:!1},history:{history:!1},addclass:"stack-modal",stack:{dir1:"down",dir2:"right",modal:!0}}).get().on("pnotify.confirm",a).on("pnotify.cancel",function(){});break;default:PNotify.removeAll(),new PNotify({title:"Error(s) found!",text:"Action not found",type:"error"})}else PNotify.removeAll(),new PNotify({title:"Error(s) found!",text:"No selected record",type:"error"})}};return t}]),t.factory("PersonaFactory",[function(){var t={API_URL:"/persons",SearchPersona:function(t,e,o){$(t).select2({width:"100%",ajax:{url:this.API_URL+"/search",delay:500,data:function(t){return{search:t.term,stat:1,type:e}},processResults:function(t){var o=[];return"customer"==e&&o.push({id:"-1",text:"*Walkin Customer*"}),t.forEach(function(t,e){o.push(t);var r=o.length-1;o[r].id=t.pk_persons,o[r].text=t.fullname}),{results:o}}}})}};return t}]),t.factory("DiscountsFactory",[function(){var t={API_URL:"/discounts",SearchDiscount:function(t,e){e.mscDiscountRate=[],$(t).select2({width:"100%",ajax:{url:this.API_URL+"/search",delay:500,data:function(t){return{search:t.term,stat:1}},processResults:function(t){e.mscDiscountRate=t;var o=[];return o.push({id:"-1",text:"*Not Applicable*"}),t.forEach(function(t,e){o.push(t);var r=o.length-1;o[r].id=t.pk_discounts,o[r].text=t.description+" ["+parseFloat(t.rate)+"%]"}),{results:o}}}})}};return t}]),t.factory("ProductsFactory",[function(){var t={API_URL:"/products",SearchProducts:function(t,e,o,r){o.issubmitting||(PNotify.removeAll(),$("#divproductlist").prop("hidden",!0),$("#loadingsearchitem").prop("hidden",!1),o.issubmitting=!0,e.get(t,{}).then(function(t){$("#divproductlist").prop("hidden",!1),$("#loadingsearchitem").prop("hidden",!0),o.issubmitting=!1;var e=t.data.products;o.initPagination(e),o.productlist=e.data,"searchbarcode"==r&&(o.productlist.length>0?(o.searchbarcode="",o.AddItem(o.productlist[0],1,"click")):new PNotify({title:"Error(s) Found!",text:"Product Barcode not found!",type:"error"}))},function(t){new PNotify({title:"Error(s) found!",text:"please see logs for details",type:"error"}),console.log(t.data)}))},SearchProductsPerStore:function(t,e,o){var r=$("#fk_stores").val();$(t).select2({width:"100%",placeholder:"Search "+e+"  here...",ajax:{url:this.API_URL+"/searchproductsperstore",delay:500,data:function(t){return{search:t.term,stat:1,fk_stores:r}},processResults:function(t){var e=[];return e.push({id:"-1",text:"All"}),t.forEach(function(t,o){e.push(t);var r=e.length-1;e[r].id=t.pk_products,e[r].text=t.name+" ("+t.category+") "}),{results:e}}}})}};return t}]),t.factory("PaymentsFactory",[function(){var t={ShowPaymentsModal:function(t){$("#ajaxmodalfootersubmit").prop("disabled",!1),t.mop="cash",t.paidamount=t.salesmstr.totalpayment,t.balanceamount=parseFloat(t.netamount)-parseFloat(t.paidamount),t.paymentamount=t.balanceamount,t.changeamount=parseFloat(t.balanceamount)-parseFloat(t.paymentamount),t.cardno=null,t.cardholder=null,t.cardmonth=null,t.cardyear=null,t.cardcodecv=null,t.chequeno=null,t.remarks=null,t.balanceamount<=0&&($("#ajaxmodalfootersubmit").prop("disabled",!0),t.paymentamount=0,t.changeamount=0),$("#newPaymentsModal").modal("show")},SubmitAjaxModal:function(t,e,o,r,a){if(PNotify.removeAll(),""==t.payername)return $("#payername").focus(),void new PNotify({title:"Woops!",text:"payername is required",type:"info"});e.configAjaxSubmitModal("on");var n={payername:t.payername,mop:t.mop,paymentamount:t.paymentamount,"changeamount ":t.changeamount,cardno:t.cardno,cardholder:t.cardholder,cardmonth:t.cardmonth,cardyear:t.cardyear,cardcodecv:t.cardcodecv,chequeno:t.chequeno,remarks:t.remarks};r.post(o,n).then(function(o){e.configAjaxSubmitModal("off");var r=o.data;1==a?(t.salesmstr={},t.salesdtl=[],$("#pk_salesmstr option[value="+t.pk_salesmstr+"] ").remove(),t.lastsalesmstr=r.salesmstr[0],t.lastsalesdtl=r.salesdtl,t.pk_salesmstr=null,$("#receiptModal").modal("show")):location.reload(),$("#newPaymentsModal").modal("hide")},function(t){new PNotify({title:"Error(s) found!",text:"please see logs for details",type:"error"}),console.log(t.data),e.configAjaxSubmitModal("off")})}};return t}]),t.factory("UserFactory",[function(){var t={API_URL:"/users",SearchUser:function(t,e){$(t).select2({width:"100%",ajax:{url:this.API_URL+"/search",delay:500,data:function(t){return{search:t.term,stat:1}},processResults:function(t){var e=[];return e.push({id:"-1",text:"All"}),t.forEach(function(t,o){e.push(t);var r=e.length-1;e[r].id=t.id,e[r].text=t.name}),{results:e}}}})}};return t}])}();