angular.module("app",["AppServices"]).constant("API_URL","/sales").config(["$httpProvider",function(e){e.defaults.headers.common["X-Requested-With"]="XMLHttpRequest"}]).controller("SalesController",["$http","API_URL","PNotifyFactory","SQLSTATEFactory","GlobalFactory","PaymentsFactory",function(e,t,a,s,o,l){var n=this;null==$("#form_title").val()&&(n.search=$("#globalsearch").val(),$("#globalsearch").focus(),$("#filterCollapseCheckbox").prop("checked",!1),n.lastsalesmstr={},n.lastsalesdtl={}),n.Edit=function(o,l){n.selectedID=o,n.selectedStat=l,n.form_title="update_sales_stat",a.setConfirmation(n,e,s,t)},n.Delete=function(o,l){n.selectedID=o,n.selectedStat=l,n.form_title="delete",a.setConfirmation(n,e,s,t)},n.ShowPayentsModal=function(a,s){n.salesmstr={},n.payments=[],e.get(t+"/showpayments/"+a,{}).then(function(e){var t=e.data;n.salesmstr=t.salesmstr,n.payments=t.payments,n.salesmstr.balanceamount=parseFloat(n.salesmstr.netamount)-parseFloat(n.salesmstr.totalpayment),$("#showPaymentsModal").modal("show")},function(e){new PNotify({title:"Error(s) found!",text:"please see logs for details",type:"error"}),console.log(e.data)})},n.ShowPayments=function(e,t){PNotify.removeAll(),n.payment_title="show",n.ShowPayentsModal(e,t)},n.DeletePayments=function(e,t){n.payment_title="delete",n.ShowPayentsModal(e,t)},n.SubmitDeletePayments=function(a){$("#loadingdeletepayments").prop("hidden",!1),$("#divtblpayments").prop("hidden",!0),$("#ajaxmodalcancelshowpaymentsmodal").prop("disabled",!0),e.put(t+"/deletepayments/"+a.pk_salespayments,{}).then(function(e){location.reload()},function(e){s.state(e.data),$("#loadingdeletepayments").prop("hidden",!0),$("#divtblpayments").prop("hidden",!1)})},n.ValidateNumber=function(e,t){switch(t){case"payment":(isNaN(n.paymentamount)||null==n.paymentamount)&&(n.paymentamount=1),n.changeamount=-1*(parseFloat(n.balanceamount)-parseFloat(n.paymentamount))}},n.AddPayments=function(a,s){PNotify.removeAll(),e.get(t+"/show/"+a,{}).then(function(e){var t=e.data;t.salesmstr.length>0&&(n.salesmstr=t.salesmstr[0],n.pk_salesmstr=n.salesmstr.pk_salesmstr,n.payername=n.salesmstr.payername,n.netamount=n.salesmstr.netamount,n.paidamount=n.salesmstr.totalpayment,l.ShowPaymentsModal(n))},function(e){new PNotify({title:"Error(s) found!",text:"please see logs for details",type:"error"}),console.log(e.data)})},$("#ajaxmodalfootersubmit").click(function(){var a=t+"/payments/"+n.pk_salesmstr;l.SubmitAjaxModal(n,o,a,e,0)}),n.ViewReceipt=function(a,s){n.pk_salesmstr=a,e.get(t+"/show/"+n.pk_salesmstr,{}).then(function(e){var t=e.data;t.salesmstr.length>0&&(n.lastsalesmstr=t.salesmstr[0],n.lastsalesdtl=t.salesdtl,n.stores=t.stores,$("#onloadReceiptHeader").prop("hidden",!0),$("#onloadReceiptFooter").prop("hidden",!0),$("#specificReceiptHeader").prop("hidden",!1),$("#specificReceiptFooter").prop("hidden",!1),$("#receiptModal").modal("show"))},function(e){new PNotify({title:"Error(s) found!",text:"please see logs for details",type:"error"}),console.log(e.data)})},$("#ajaxmodalprintreceipt").click(function(){$("#printarea").printThis()}),n.applyFilters=function(){var e=$("#dateFrom").val(),a=$("#dateTo").val(),s=$("#fk_stores").val();location.href=t+"?search="+n.search+"&dateFrom="+e+"&dateTo="+a+"&fk_stores="+s},n.globalSearch=function(){n.applyFilters()},$("#ApplyGlobalFilters").click(function(){n.applyFilters()})}]);