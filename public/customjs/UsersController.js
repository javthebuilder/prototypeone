angular.module("app",["AppServices"]).constant("API_URL","/users").config(["$httpProvider",function(e){e.defaults.headers.common["X-Requested-With"]="XMLHttpRequest"}]).controller("UsersController",["$http","API_URL","PNotifyFactory","SQLSTATEFactory","GlobalFactory",function(e,t,s,o,l){var n=this;if(null==$("#form_title").val()&&(n.search=$("#globalsearch").val(),$("#globalsearch").focus()),n.Delete=function(l,c){n.selectedID=l,n.selectedStat=c,n.form_title="delete",s.setConfirmation(n,e,o,t)},n.globalSearch=function(){location.href=t+"?search="+n.search},"accessibility"==$("#form_title").val()){n.modules=[],n.stores=[];var c=$("#pk_userid").val().trim();l.configLoadingBlade("on"),l.configAjaxSubmitBlade("on"),setTimeout(function(){e.get(t+"/accessibility/"+c+"?"+Math.random()).then(function(e){var t=e.data;l.configLoadingBlade("off"),l.configAjaxSubmitBlade("off"),PNotify.removeAll(),"object"==typeof t&&Object.keys(t).length>0&&(t.A.forEach(function(e,s){n.modules.push(e),n.modules[n.modules.length-1].selected=null!=e.fk_users,n.modules[n.modules.length-1].tips="",t.B.forEach(function(s,o){e.family==s.family&&(n.modules.push(s),n.modules[n.modules.length-1].indent="&nbsp;&nbsp;&nbsp;&nbsp;",n.modules[n.modules.length-1].selected=null!=s.fk_users,n.modules[n.modules.length-1].tips="Required module [ "+e.description+" ]",t.C.forEach(function(e,t){s.url==e.family&&(n.modules.push(e),n.modules[n.modules.length-1].indent="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",n.modules[n.modules.length-1].tips="Required module [ "+s.description+" ]",n.modules[n.modules.length-1].selected=null!=e.fk_users)}))})}),t.stores.forEach(function(e,t){n.stores.push(e),n.stores[n.stores.length-1].selected=null!=e.fk_users}))},function(e){new PNotify({title:"Error(s) found!",text:"please see logs for details",type:"error"}),console.log(e.data)})},1e3)}n.SelectDeselect=function(e,t){if(null!=e){switch(t){case"modules":n.isSelectAllModules=!1;break;case"stores":n.isSelectAllStores=!1}n.LoopSelectedModules(e)}else switch(t){case"modules":var s=n.isSelectAllModules;n.modules.forEach(function(e,t){e.selected=s});break;case"stores":s=n.isSelectAllStores,n.stores.forEach(function(e,t){e.selected=s})}},n.LoopSelectedModules=function(e){n.modules.forEach(function(t,s){"B"==e.type&&e.url==t.family&&(e.selected?t.selected=!0:t.selected=!1)})},$("#btnAjaxSubmit").click(function(){PNotify.removeAll();var s=[],o=[];n.modules.forEach(function(e,t){e.selected&&s.push(e)}),n.stores.forEach(function(e,t){e.selected&&o.push(e)});var c=$("#pk_userid").val().trim();l.configAjaxSubmitBlade("on"),e.post(t+"/accessibility/"+c,{modules:s,stores:o}).then(function(e){new PNotify({title:"Succesful!",text:"transaction complete",type:"success"}),l.configAjaxSubmitBlade("off")},function(e){new PNotify({title:"Error(s) found!",text:"please see logs for details",type:"error"}),console.log(e.data),l.configAjaxSubmitBlade("on")})})}]);